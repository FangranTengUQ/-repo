# Fangran 的实习项目指南 - AI 语音压缩

你好 Fangran！这份文档是我为你整理的项目说明，希望能帮你快速上手这个实习项目。

## 项目概览

这个项目的核心目标是**使用 AI 技术进行高效的语音/音频压缩**。

在传统的通信（如打电话、蓝牙音频）中，我们使用像 MP3, AAC, Opus 这样的算法。而你现在的任务是研究和使用 Meta (Facebook) 开发的 **Encodec** 模型。这是一种基于深度学习的“神经音频编解码器 (Neural Audio Codec)”。

**为什么这对“芯昇科技”很重要？**
芯昇科技（CMCC Chip）专注于芯片设计。在低功耗芯片（如物联网设备、智能穿戴）上，带宽非常宝贵。
*   **Encodec 的优势**：它能在极低的带宽下（比如 6kbps 甚至更低），提供比传统算法（MP3/Opus）好得多的音质。
*   **应用场景**：超低带宽的对讲机、高质量的蓝牙传输、卫星通信语音压缩。

---

## 文件夹结构说明

你的工作目录主要在 `4 Fangran/` 下：

```text
4 Fangran/
├── encodec/               # 核心代码库 (Meta Encodec)
│   ├── main.py            # [重要] 主运行脚本，你的入口点
│   ├── compress.py        # 压缩/解压缩的底层逻辑
│   ├── model.py           # 定义了神经网络模型的结构
│   ├── modules/           # 包含卷积层、LSTM等网络组件
│   ├── quantization/      # 量化模块 (核心技术，把连续信号变离散编码)
│   └── ...
├── arch.pdf               # 可能的模型架构说明文档
└── ...
```

---

## [更新] 解决失真问题：如何平衡带宽与音质

针对 Mentor 提到的“音频失真明显”和“平衡带宽”的需求，我更新了 `main.py`。

新的脚本会自动测试 **5 种不同的带宽**（从 1.5kbps 到 24kbps），并计算出每个带宽下的**失真度 (MSE)**。

### 1. 运行步骤

确保你有一个测试音频（例如 `1.wav`）在 `encodec` 文件夹下。

```bash
cd "4 Fangran/encodec"
export PYTHONPATH=$PYTHONPATH:"/app/4 Fangran"
python3 main.py
```

### 2. 输出结果

运行结束后，你会看到类似下面的输出表：

```text
带宽(kbps)        | 压缩比(约)          | 失真度(MSE)
--------------------------------------------------
1.5             | 256.0           | 0.016097
3.0             | 128.0           | 0.004350
6.0             | 64.0            | 0.002046
12.0            | 32.0            | 0.001458
24.0            | 16.0            | 0.000953
```

同时，在 `results/` 文件夹下会生成 5 个文件：
*   `output_1.5kbps.wav` (极低带宽，音质最差)
*   `output_3.0kbps.wav`
*   `output_6.0kbps.wav`
*   `output_12.0kbps.wav`
*   `output_24.0kbps.wav` (较高带宽，音质最好)

### 3. 如何向 Mentor 汇报

你需要做的是**主观听测**和**数据展示**：

1.  **听**：带上耳机，仔细听这 5 个文件。
    *   **1.5kbps** 和 **3.0kbps** 可能会有明显的机械音或模糊。
    *   **6.0kbps** 通常是一个“甜点”，即音质尚可，带宽也很低。
    *   **12.0kbps** 和 **24.0kbps** 应该非常接近原声。

2.  **选**：找到那个“你觉得听起来不再刺耳，且带宽尽可能低”的文件。
    *   如果 Mentor 觉得 6kbps 失真大，那就给他听 12kbps 的。
    *   如果 12kbps 还不行，就用 24kbps。

3.  **说**：你可以这样跟 Mentor 说：
    > “导师，我测试了从 1.5kbps 到 24kbps 的所有模式。
    > 目前看来，**6kbps** 下的 MSE 误差是 0.002，压缩比是 64倍。
    > 如果追求更高音质，建议使用 **12kbps**，虽然带宽增加了一倍，但失真度降低了 30%（MSE 降到了 0.0014）且听感明显改善。
    > 这是生成的对比音频，您可以听一下。”

---

## 核心代码解析 (`main.py`)

*   **`model.set_target_bandwidth(bw)`**：这是调节的核心旋钮。
*   **MSE 计算**：我在代码里加了 `torch.mean((input - output)**2)`，这是一个数学上的“失真度”指标，越小越好。

祝你实习顺利！如果有报错，记得看 `main.py` 里的 `try...except` 部分打印的错误信息。
